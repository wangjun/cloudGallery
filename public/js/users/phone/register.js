$(document).ready(function(){"use strict";function a(){$.get("/utility/i-am-not-a-robot",function(a,b){if(b){g.find(".modal-title").text("请输入验证码");var c='<form action="/utility/check-captcha" method="POST" id="captcha-form" class="form-horizontal"><input type="hidden" name="_csrf" id="csrf-token" value="'+a.csrfToken+'"><div class="form-group"><div class="col-sm-12">'+a.captchaHtml+'</div></div><div class="form-group"><label class="col-sm-2 control-label" for="mobile">验证码</label><div class="col-sm-10"><input name="captcha-text" type="tel" class="form-control" id="captcha-text" placeholder="请输入上方验证码"></div><span class="help-block col-sm-offset-2 col-sm-10"></span></div></form>';g.find(".modal-body").html(c)}else console.error("网站或网络错误，无法继续")})}function b(a){a=a||60,e.prop("disabled",!0);var b=a,c=setInterval(function(){e.text(b+"秒后重新发送"),b--,0===b&&(clearInterval(c),e.prop("disabled",!1).text(f))},1e3)}function c(a){b(a),$.post("/utility/send-sms",{mobile:"18675959065"},function(a,b){b?console.log(a):console.log("请求短信发送服务器失败")})}var d=$("#register"),e=d.find("#get-mobile-captcha"),f=e.text(),g=$("#modal"),h=g.find("#ok");e.on("click",function(b){b.preventDefault(),$.get("/utility/check-is-human",function(b,d){d&&(b.isHuman?c():(g.modal("show"),a()))})}),h.on("click",function(){var b=g.find("#captcha-text").val(),d=g.find("#csrf-token").val();$.post("/utility/check-captcha",{_csrf:d,captchaText:b},function(b,d){"success"===d?b.isHuman?(g.modal("hide"),c()):(a(),g.find(".help-block").text("验证码错误，请重新输入")):console.log("网站或网络错误，无法继续。")})}),$.get("/utility/is-allowed-to-send-sms",function(a,c){if("success"===c){if(a.status)return!1;$.isNumeric(a.reason)?b(parseInt(a.reason)):console.log(a.reason)}else console.log("网络错误。")})});