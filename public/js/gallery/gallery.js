"use strict";lcApp.controller("galleryCtr",["$scope",function(a){var b=$("#upload-button"),c=$("#upload-input"),d=$("#images"),e=$("#remove-image-button"),f=$("#show-image-modal"),g=a.galleryId,h={},i=$(".main-gallery");b.on("click",function(a){a.preventDefault(),c.trigger("click")}),c.on("change",function(){for(var a=this.files,b=0;b<a.length;b++){var c=a[b],e=new Uploader(c,d);e.upload()}}),$(document).on("click",".card",function(a){a.preventDefault(),$(this).hasClass("uploading")?window.alertModal("上传中，请耐心等待..."):f.modal({onVisible:function(){i.flickity("resize")}}).modal("show")}),a.removeImage=function(){var b=[1,2,4,5,7],c=new Uploader;e.addClass("loading disabled"),c.removeItem(a.currentImageHash,g,function(a){-1===b.indexOf(a.state)?e.html("删除失败").addClass("disabled"):window.$imagesLayout.masonry("remove",$(".card[data-hash="+h.hash+"]")).masonry("layout")})},$("#hide-image-modal").on("click",function(a){a.preventDefault(),f.modal("hide")}),f.modal({onHidden:function(){e.removeClass("loading disabled"),e.html("删除")}}),$("#weibo-share-btn").on("click",function(a){a.preventDefault(),$.post("/society/weibo/share",{content:"testing"},function(a,b){"success"===b&&(4===a.state&&window.alertModal("你尚未登录。"),console.log(a))})}),window.$imagesLayout=d.masonry({itemSelector:".card",percentPosition:!1}),window.$imagesLayout.imagesLoaded().progress(function(){window.$imagesLayout.masonry("layout")}),i.flickity({pageDots:!1,percentPosition:!1,imagesLoaded:!0,setGallerySize:!1}),a.selectImage=function(b,c){var d=parseInt(c);a.currentImageHash=b,i.flickity("select",d)}}]);